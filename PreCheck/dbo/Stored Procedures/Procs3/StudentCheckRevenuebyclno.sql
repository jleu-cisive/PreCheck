
-- this sp is used in q reports  for StudentCheck Upsell report

CREATE PROCEDURE [dbo].[StudentCheckRevenuebyclno]
  @StartDate datetime,
@EndDate datetime
as
  set nocount on
  select ii.invdate,a.apno,c.clno,c.name as clientname,cp.name as programname,case when a.packageid is null then
(select top 1 rate from clientpackages  with (nolock) where clno = c.clno) else cps.rate end as PKGRATE ,
pm.packagedesc as assignedpackagename,
case when a.packageid is null then (select top 1 z.packagedesc from clientpackages x  with (nolock) 
inner join packagemain z  with (nolock) on x.packageid = z.packageid where clno = c.clno)
else '' end as defaultpackagename,SSN
 from appl a  with (nolock) 
 inner join client c  with (nolock) on a.clno = c.clno
inner join clientprogram cp  with (nolock) on cp.clientprogramid = a.clientprogramid
left join clientpackages cps  with (nolock) on cps.packageid = a.packageid and cps.clno = c.clno
left join packagemain pm  with (nolock) on pm.packageid = cps.packageid
inner join invdetail i with (nolock) on i.apno = a.apno and i.type = 0
inner join invmaster ii   with (nolock) on ii.invoicenumber = i.invoicenumber
where ii.invdate >= @StartDate and ii.invdate < @EndDate

and c.clno in
(2382,
2420,
2421,
2429,
2430,
2431,
2452,
2457,
2460,
2474,
2476,
2495,
2503,
2506,
2507,
2508,
2514,
2515,
2516,
2517,
2518,
2520,
2521,
2522,
2524,
2529,
2550,
2552,
2586,
2589,
2806,
2810,
2814,
2818,
2828,
2879,
2882,
2886,
2888,
2894,
2898,
2901,
2904,
2919,
2943,
2978,
3000,
3016,
3017,
3026,
3030,
3031,
3036,
3044,
3049,
3050,
3052,
3055,
3063,
3070,
3077,
3105,
3108,
3122,
3124,
3144,
3145,
3146,
3147,
3148,
3154,
3156,
3157,
3174,
3184,
3192,
3193,
3213,
3215,
3216,
3220,
3221,
3222,
3225,
3234,
3236,
3240,
3241,
3243,
3245,
3263,
3265,
3266,
3272,
3273,
3274,
3281,
3282,
3283,
3284,
3288,
3303,
3305,
3306,
3307,
3308,
3309,
3310,
3311,
3312,
3313,
3314,
3315,
3316,
3317,
3318,
3319,
3320,
3321,
3322,
3323,
3324,
3325,
3326,
3332,
3333,
3334,
3335,
3336,
3337,
3338,
3339,
3348,
3349,
3350,
3351,
3352,
3353,
3354,
3361,
3362,
3363,
3364,
3366,
3374,
3375,
3376,
3377,
3380,
3381,
3383,
3384,
3385,
3387,
3388,
3389,
3390,
3391,
3392,
3395,
3398,
3401,
3404,
3406,
3409,
3411,
3412,
3417,
3418,
3424,
3427,
3428,
3430,
3431,
3432,
3433,
3434,
3438,
3440,
3444,
3448,
3450,
3456,
3457,
3459,
3460,
3465,
3466,
3473,
3474,
3475,
3476,
3480,
3487,
3497,
3500,
3505,
3506,
3507,
3514,
3518,
3518,
3519,
3519,
3520,
3520,
3521,
3521,
3522,
3522,
3523,
3523,
3524,
3524,
3525,
3525,
3526,
3526,
3527,
3527,
3528,
3528,
3529,
3560,
3561,
3562,
3563,
3564,
3565,
3566,
3567,
3568,
3569,
3576,
3578,
3579,
3580,
3581,
3582,
3583,
3584,
3594,
3613,
3620,
3632,
3645,
3646,
3648,
3649,
3650,
3651,
3662,
3668,
3669,
3673,
3674,
3679,
3680,
3681,
3682,
3684,
3694,
3697,
3702,
3703,
3704,
3705,
3706,
3707,
3708,
3709,
3710,
3711,
3712,
3714,
3715,
3716,
3717,
3718,
3719,
3720,
3721,
3725,
3727,
3728,
3729,
3730,
3734,
3740,
3741,
3745,
3761,
3767,
3770,
3771,
3777,
3778,
3782,
3785,
3789,
3794,
3801,
3806,
3812,
3813,
3816,
3818,
3820,
3822,
3823,
3824,
3825,
3826,
3827,
3838,
3839,
3840,
3841,
3861,
3862,
3863,
3869,
3872,
3873,
3875,
3876,
3880,
3885,
3909,
3912,
3952,
3972,
3975,
3977,
3978,
3980,
3981,
3982,
3983,
3984,
3985,
3992,
3993,
3995,
3997,
4002,
4012,
4013,
4014,
4015,
4016,
4017,
4018,
4019,
4020,
4024,
4032,
4036,
4038,
4041,
4042,
4045,
4056,
4068,
4070,
4073,
4073,
4077,
4079,
4082,
4088,
4091,
4094,
4098,
4099,
4105,
4108,
4109,
4110,
4111,
4112,
4113,
4114,
4116,
4120,
4123,
4129,
4131,
4133,
4147,
4149,
4150,
4151,
4152,
4161,
4244,
4667,
5016,
5021,
5022,
5026,
5030,
5039,
5042,
5044,
5083,
5099,
5104,
5105,
5106,
5116,
5120,
5135,
5162,
5167,
5172,
5173,
5178,
5179,
5186,
5187,
5190,
5191,
5193,
5194,
5195,
5204,
5206,
5223,
5264,
5268,
5272,
5273,
5275,
5288,
5291,
5292,
5295,
5296,
5308,
5310,
5318,
5319,
5320,
5323,
5336,
5337,
5345,
5346,
5348,
5350,
5351,
5355,
5372,
5377,
5389,
5391,
5410,
5414,
5415,
5416,
5417,
5418,
5419,
5420,
5428,
5431,
5451,
5460,
5465,
5476,
5493,
5505,
5508,
5512,
5536,
5539,
5540,
5546,
5548,
5554,
5568,
5569,
5575,
5576,
5577,
5578,
5579,
5581,
5583,
5584,
5585,
5586,
5588,
5595,
5604,
5607,
5627,
5643,
5646,
5651,
5670,
5671,
5673,
5688,
5714,
5720,
5721,
5723,
5735,
5736,
5740,
5748,
5749,
5758,
5761,
5762,
5823,
5826,
5829,
5836,
5842,
5845,
5866,
5870,
5877,
5898,
5913,
5914,
5927,
5950,
5954,
5967,
5973,
5999,
6002,
6038,
6042,
6054,
6067,
6127,
6132,
6139,
6202,
6219,
6221,
6247,
6267,
6328,
6329,
6330,
6334,
6336,
6405,
6496,
6499,
6500,
6511,
6521,
6522,
6552,
6712,
6731,
6810,
6877,
6927,
6959,
6961,
6962,
7005,
7006,
7007,
7008,
7063,
7076,
7097,
7115,
7130,
7138,
7221,
7256,
7338,
7542,
7589,
7617,
7618,
7619,
7707,
7713,
7914,
7919)
order by ii.invdate,c.clno,cp.name





